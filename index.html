<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sales Navigator 会社URLビルダー</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#111319;
      --card2:#0f1117;
      --text:#e9ecf1;
      --muted:#a8b0bd;
      --line:#222635;
      --accent:#7aa2ff;
      --accent2:#7ef0c1;
      --warn:#ffcc66;
      --danger:#ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb; --card:#ffffff; --card2:#fbfbfe; --text:#111827; --muted:#5b6472;
        --line:#e5e7ef; --accent:#2f5eff; --accent2:#0ea5e9; --warn:#b45309; --danger:#dc2626;
        --shadow: 0 12px 26px rgba(17,24,39,.08);
      }
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:28px;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Sans","Noto Sans JP","Yu Gothic",sans-serif;
      background:var(--bg); color:var(--text);
      line-height:1.45;
    }
    .wrap{max-width:1100px;margin:0 auto}
    .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:16px; flex-wrap:wrap;
      margin-bottom:18px;
    }
    h1{font-size:20px;margin:0 0 6px 0;letter-spacing:.2px}
    .subtitle{color:var(--muted); font-size:12.5px; margin:0}
    .badge{
      display:inline-flex; gap:8px; align-items:center;
      border:1px solid var(--line); background:var(--card2);
      padding:6px 10px; border-radius:999px; color:var(--muted); font-size:12px;
    }
    .grid{display:grid; grid-template-columns: 1.3fr .7fr; gap:16px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .card{
      background:var(--card); border:1px solid var(--line); border-radius:var(--radius);
      padding:16px; box-shadow:var(--shadow);
    }
    .card h2{
      font-size:14px; margin:0 0 10px 0; letter-spacing:.2px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .hint{color:var(--muted); font-size:12px; margin-top:6px}
    textarea, input, select{
      width:100%;
      background:transparent;
      border:1px solid var(--line);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      font-size:13px;
    }
    textarea{min-height:210px; resize:vertical}
    select{cursor:pointer}
    .row{display:grid; grid-template-columns:1fr; gap:10px}
    .two{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 540px){ .two{grid-template-columns:1fr} }

    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-size:13px;
    }
    button.primary{
      border-color: rgba(122,162,255,.35);
      background:linear-gradient(180deg, rgba(122,162,255,.28), rgba(122,162,255,.10));
    }
    button.ghost{
      background:transparent;
    }
    button:active{transform:translateY(1px)}
    .status{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      border:1px solid var(--line);
      background:var(--card2);
      border-radius:999px;
      padding:4px 10px;
      font-size:12px;
      color:var(--muted);
    }
    .ok{color:var(--accent2); font-weight:600}
    .warn{color:var(--warn); font-weight:600}
    .danger{color:var(--danger); font-weight:600}

    .out{min-height:150px; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .splitOut{display:grid; grid-template-columns:1fr; gap:10px}

    details{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
      background:var(--card2);
    }
    summary{cursor:pointer; color:var(--text); font-size:13px}
    .small{font-size:12px;color:var(--muted);margin-top:6px}
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>Sales Navigator 会社URLビルダー</h1>
      <p class="subtitle">
        会社名を貼り付け → former/current/both を選択 → <span class="ok">共有URL（sessionIdなし）</span> と
        <span class="warn">個人URL（sessionIdあり・任意）</span> を自動生成します。
      </p>
    </div>
    <div class="badge">
      <span>Team Share</span>
      <span class="mono">no sessionId</span>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>
        <span>入力</span>
        <span class="pill"><span class="ok">自動補完</span>＋別名展開</span>
      </h2>

      <label><b>会社名（1行＝1社）</b></label>
      <textarea id="companies" placeholder="例：
高砂香料工業
長谷川香料
International Flavors & Fragrances
Archer-Daniels-Midland"></textarea>
      <div class="hint">
        日/英どちらでもOK。必要に応じて「株式会社/Co.,Ltd」削除版、公式英名、略称（ADM / IFF など）を自動追加します。
      </div>

      <div style="height:12px;"></div>

      <div class="two">
        <div class="row">
          <label><b>モード</b></label>
          <select id="mode">
            <option value="PAST">former only（PAST_COMPANY）</option>
            <option value="CURRENT">current only（CURRENT_COMPANY）</option>
            <option value="BOTH">both（CURRENT + PAST）</option>
          </select>
        </div>
        <div class="row">
          <label><b>自動補完（辞書）</b></label>
          <select id="dictMode">
            <option value="ON" selected>ON（推奨）</option>
            <option value="OFF">OFF（入力のみ）</option>
          </select>
        </div>
      </div>

      <div style="height:10px;"></div>

      <details>
        <summary><b>高度な設定（任意）</b>：個人URL用 sessionId</summary>
        <div style="height:8px;"></div>
        <label><b>sessionId（空欄OK）</b></label>
        <input id="sessionId" type="text" placeholder="例：uxiEiZxoT3uEC+7v3ul6vQ==" />
        <div class="small">
          共有URLは sessionId なしで生成されるため、チーム共有に最適です。個人URLだけ sessionId を付与できます。
        </div>
      </details>

      <div class="btns">
        <button class="primary" id="buildBtn">URLを生成</button>
        <button id="copyTeamBtn">共有URLをコピー</button>
        <button id="openTeamBtn" class="ghost">共有URLを開く</button>
        <button id="copyPersonalBtn">個人URLをコピー</button>
        <button id="openPersonalBtn" class="ghost">個人URLを開く</button>
      </div>

      <div id="status" class="status"></div>
    </div>

    <div class="card">
      <h2><span>出力</span><span class="pill">コピーして使う</span></h2>
      <div class="splitOut">
        <div>
          <label><b>生成URL（共有 / 個人）</b></label>
          <textarea id="output" class="out" readonly></textarea>
          <div class="hint">
            共有URL：sessionId なし（チーム共有用）／ 個人URL：sessionId あり（任意）
          </div>
        </div>
        <div>
          <label><b>実際に検索へ投入する会社キーワード（展開後）</b></label>
          <textarea id="expanded" class="out" readonly></textarea>
          <div class="hint">
            ここで「展開しすぎ（例：短すぎる別名）」がないか確認できます。必要なら辞書OFFに。
          </div>
        </div>
      </div>
    </div>
  </div>

  <p class="subtitle" style="margin-top:14px;">
    Tips：表示が変わらない場合は URL の末尾に <span class="mono">?v=1</span> を付けてキャッシュ回避してください。
  </p>
</div>

<script>
  // ---------- Helpers ----------
  function uniq(arr) {
    const seen = new Set();
    const out = [];
    for (const x of arr) {
      const k = (x || "").trim();
      if (!k) continue;
      const key = k.toLowerCase();
      if (seen.has(key)) continue;
      seen.add(key);
      out.push(k);
    }
    return out;
  }

  function stripKabushikiKaishaJP(name) {
    return name.replace(/株式会社/g, "").trim();
  }

  function stripCoLtdEN(name) {
    let s = name;
    s = s.replace(/\bCo\.,?\s*Ltd\.?\b/gi, "").trim();
    s = s.replace(/\bCompany\s+Limited\b/gi, "").trim();
    s = s.replace(/\bLtd\.?\b/gi, "").trim();
    s = s.replace(/\bLimited\b/gi, "").trim();
    s = s.replace(/[,\.\-–—\s]+$/g, "").trim();
    return s;
  }

  function buildValuesList(names) {
    return names.map(n => `(text:${n},selectionType:INCLUDED)`).join(",");
  }

 function encodeForLinkedInQuery(s) {
  return encodeURIComponent(s)
    .replace(/\(/g, "%28")
    .replace(/\)/g, "%29")
    .replace(/,/g, "%2C");
}

function buildSNUrl({ mode, names, sessionId }) {
  const values = buildValuesList(names);
  const recent = `(recentSearchParam:(doLogHistory:true))`;

  let filters = "";
  if (mode === "PAST") {
    filters = `filters:List((type:PAST_COMPANY,values:List(${values})))`;
  } else if (mode === "CURRENT") {
    filters = `filters:List((type:CURRENT_COMPANY,values:List(${values})))`;
  } else {
    filters = `filters:List((type:PAST_COMPANY,values:List(${values})),(type:CURRENT_COMPANY,values:List(${values})))`;
  }

  const queryObj = `(${recent},${filters})`;

  const encodedQuery = encodeForLinkedInQuery(queryObj);
  const base = `https://www.linkedin.com/sales/search/people?query=${encodedQuery}&viewAllFilters=true`;

  if (sessionId && sessionId.trim()) {
    return `${base}&sessionId=${encodeURIComponent(sessionId.trim())}`;
  }
  return base;
}

  // ---------- Auto expansion dictionary ----------
  // NOTE: ここは後でどんどん増やせます（業界ごとに追加もOK）
  const EXPANSION_DICT = {
    // 香料（例）
    "高砂香料工業": ["TAKASAGO INTERNATIONAL CORPORATION", "TAKASAGO INTERNATIONAL"],
    "長谷川香料": ["T. HASEGAWA CO., LTD.", "T. HASEGAWA"],
    "小川香料": ["Ogawa & Co., Ltd.", "Ogawa &"],
    "塩野香料": ["SHIONO KORYO KAISHA, LTD", "SHIONO KORYO KAISHA"],

    // グローバル略称（例）
    "Archer-Daniels-Midland": ["ADM"],
    "International Flavors & Fragrances": ["IFF"]
  };

  function expandNames(inputNames, dictOn) {
    let out = [];
    for (const raw of inputNames) {
      const n = raw.trim();
      if (!n) continue;

      // original
      out.push(n);

      // JP stripped
      const jpStripped = stripKabushikiKaishaJP(n);
      if (jpStripped && jpStripped !== n) out.push(jpStripped);

      // EN stripped
      const enStripped = stripCoLtdEN(n);
      if (enStripped && enStripped !== n) out.push(enStripped);

      // dictionary expansions
      if (dictOn) {
        if (EXPANSION_DICT[n]) out.push(...EXPANSION_DICT[n]);
        if (EXPANSION_DICT[jpStripped]) out.push(...EXPANSION_DICT[jpStripped]);
        if (EXPANSION_DICT[enStripped]) out.push(...EXPANSION_DICT[enStripped]);
      }
    }

    // second pass strips
    const secondPass = [];
    for (const x of out) {
      secondPass.push(x);
      const jp = stripKabushikiKaishaJP(x);
      if (jp && jp !== x) secondPass.push(jp);
      const en = stripCoLtdEN(x);
      if (en && en !== x) secondPass.push(en);
    }

    return uniq(secondPass);
  }

  // ---------- UI ----------
  const $companies = document.getElementById("companies");
  const $mode = document.getElementById("mode");
  const $sessionId = document.getElementById("sessionId");
  const $dictMode = document.getElementById("dictMode");
  const $output = document.getElementById("output");
  const $expanded = document.getElementById("expanded");
  const $status = document.getElementById("status");

  let lastTeamUrl = "";
  let lastPersonalUrl = "";

  function parseCompanies(text) {
    return text.split(/\r?\n/).map(x => x.trim()).filter(Boolean);
  }

  function setStatus(msg, kind) {
    const cls = kind === "ok" ? "ok" : (kind === "warn" ? "warn" : (kind === "danger" ? "danger" : ""));
    $status.innerHTML = `<span class="${cls}">${msg}</span>`;
  }

  function build() {
    const input = parseCompanies($companies.value);
    const mode = $mode.value;
    const dictOn = ($dictMode.value === "ON");
    const expanded = expandNames(input, dictOn);

    lastTeamUrl = buildSNUrl({ mode, names: expanded, sessionId: "" });
    lastPersonalUrl = buildSNUrl({ mode, names: expanded, sessionId: $sessionId.value });

    $output.value =
`[共有URL（sessionIdなし）]
${lastTeamUrl}

[個人URL（sessionIdあり・任意）]
${lastPersonalUrl}`;

    $expanded.value = expanded.join("\n");

    const approxLen = lastTeamUrl.length;
    if (approxLen > 7000) {
      setStatus(`生成完了：キーワード ${expanded.length} 件 / URL長 ${approxLen}（長すぎる可能性あり。会社数を減らすか辞書OFF推奨）`, "warn");
    } else {
      setStatus(`生成完了：キーワード ${expanded.length} 件 / URL長 ${approxLen}`, "ok");
    }
  }

  async function copyText(text) {
    try {
      await navigator.clipboard.writeText(text);
      return true;
    } catch (e) {
      return false;
    }
  }

  function openUrl(url) {
    if (!url) build();
    window.open(url, "_blank", "noopener,noreferrer");
  }

  document.getElementById("buildBtn").addEventListener("click", build);

  document.getElementById("copyTeamBtn").addEventListener("click", async () => {
    if (!lastTeamUrl) build();
    const ok = await copyText(lastTeamUrl);
    setStatus(ok ? "共有URLをコピーしました" : "コピーに失敗しました（手動でコピーしてください）", ok ? "ok" : "danger");
  });

  document.getElementById("copyPersonalBtn").addEventListener("click", async () => {
    if (!lastPersonalUrl) build();
    const ok = await copyText(lastPersonalUrl);
    setStatus(ok ? "個人URLをコピーしました" : "コピーに失敗しました（手動でコピーしてください）", ok ? "ok" : "danger");
  });

  document.getElementById("openTeamBtn").addEventListener("click", () => openUrl(lastTeamUrl));
  document.getElementById("openPersonalBtn").addEventListener("click", () => openUrl(lastPersonalUrl));

  // 初期生成
  build();
</script>
</body>
</html>
